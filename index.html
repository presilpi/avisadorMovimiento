<!DOCTYPE html>
<html>
<head>
<title>Acceleration Example</title>

<link rel="stylesheet" type="text/css" href="style.css">

<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" charset="utf-8">

// The watch id references the current `watchAcceleration`
var watchID = null;

inicial=1;
cont=0;
x=0;
y=0;
z=0;

// Wait for device API libraries to load
//
document.addEventListener("deviceready", onDeviceReady, false);

// device APIs are available
//
function onDeviceReady() {

var element = document.getElementById('accelerometer');
element.innerHTML = 'onDeviceReay ... <br />';


startWatch();
}

// Start watching the acceleration
//
function startWatch() {

// Update acceleration every 3 seconds
var options = { frequency: 3000 };

watchID = navigator.accelerometer.watchAcceleration(onSuccess, onError, options);

}

// Stop watching the acceleration
//
function stopWatch() {
if (watchID) {
navigator.accelerometer.clearWatch(watchID);
watchID = null;
}
}

function reiniciarProceso(){
document.getElementById('accelerometer').innerHTML = 'reiniciando proceso x:'+x;
document.getElementById('ok1').style.display = "none";
document.getElementById('ok2').style.display = "none";
document.getElementById('ok3').style.display = "none";
document.getElementById('ok4').style.display = "none";

document.getElementById('iconGreen1').style.display = "none";
document.getElementById('iconGreen2').style.display = "none";
document.getElementById('iconGreen3').style.display = "none";
document.getElementById('iconGreen4').style.display = "none";

//alert('reiniciando');
}

// onSuccess: Get a snapshot of the current acceleration
//
function onSuccess(acceleration) {

if (inicial==1){
x=Math.floor((acceleration.x)*10);
y=Math.floor((acceleration.y)*10);
z=Math.floor((acceleration.z)*10);

  inicial=0;
}

cont=cont+1;
//alert("onsuccess"+cont);

var element = document.getElementById('accelerometer');
element.innerHTML = 'Acceleration X: ' + acceleration.x + '<br />' +
'Acceleration Y: ' + acceleration.y + '<br />' +
'Acceleration Z: ' + acceleration.z + '<br />' +
'cont: ' + cont + '<br />';

if (cont==0){
//      alert("x :"+Math.floor((acceleration.x)*100));
x=Math.floor((acceleration.x)*10);
y=Math.floor((acceleration.y)*10);
z=Math.floor((acceleration.z)*10);
}
else{
// alert("math.floor"+Math.floor((acceleration.x)*100));
       if (x!=(Math.floor((acceleration.x)*10)) || y!=(Math.floor((acceleration.y)*10)) || z!=(Math.floor((acceleration.z)*10)) ){
      cont=0;
      
 //     alert("reiniciando proceso cont="+cont);      
      reiniciarProceso();
      }
      else{
        if (cont==1) {
            document.getElementById('iconGreen1').style.display = "block";
            document.getElementById('ok1').style.display = "block";
           }
        if (cont==2) {
            document.getElementById('iconGreen2').style.display = "block";
            document.getElementById('ok2').style.display = "block";
            }
        if (cont==3) {
            document.getElementById('iconGreen3').style.display = "block";
            document.getElementById('ok3').style.display = "block";
            }
        if (cont==4) {
            document.getElementById('iconGreen4').style.display = "block";
            document.getElementById('ok4').style.display = "block";
            }
      
      }
x=Math.floor((acceleration.x)*10);
y=Math.floor((acceleration.y)*10);
z=Math.floor((acceleration.z)*10);
}

}

// onError: Failed to get the acceleration
//
function onError() {
alert('onError!');
}

</script>
</head>
<body>
<div id='contenedor'>
<div id='cabecera'>
  <div id='usuario'>Nombre del usuario</div>
  <div id='fecha'>23 Diciembre 2013</div>
  <div id='dia'>Lunes</div>
</div>
<div id='barra'>
  <img src='http://www.escalarencantabria.com/android/img/on.png' id='onOff'>
  <div id='estado'>Sistema encendido<br>Monitorizando actividad</div>
</div>

<div id='contenidos'>
<div id='fase1' class='bgGris'>
  <div class='izqBg1'>&nbsp;</div>
  <div class='izq1'><div id='iconGreen1'></div> AVISO DE 15 SEGUNDOS <span id='ok1'>FASE SUPERADA</span></div>
</div>
<div id='fase2' class='bgBlanco'>
  <div class='izqBg2'>&nbsp;</div>
  <div class='izq1'><div id='iconGreen2'></div> AVISO DE 30 SEGUNDOS<span id='ok2'>FASE SUPERADA</span></div>
</div>
<div id='fase3' class='bgGris'>
  <div class='izqBg3'>&nbsp;</div>
  <div class='izq1'><div id='iconGreen3'></div> AVISO DE 45 SEGUNDOS<span id='ok3'>FASE SUPERADA</span></div>
</div>
<div id='fase4' class='bgBlanco'>
  <div class='izqBg4'>&nbsp;</div>
  <div class='izq1'><div id='iconGreen4'></div> AVISO DE 60 SEGUNDOS<span id='ok4'>FASE SUPERADA: ENVIANDO AVISO</span></div>
</div>
</div>


<div id="accelerometer">Waiting for accelerometer...</div>

</div>


</body>
</html>
